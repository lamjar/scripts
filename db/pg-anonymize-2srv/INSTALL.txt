â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                          â•‘
â•‘     POSTGRESQL ANONYMIZE DUMP - INSTALLATION ET DÃ‰MARRAGE RAPIDE        â•‘
â•‘                                                                          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ðŸ“¦ FICHIERS LIVRÃ‰S
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. pg_anonymize_dump.sh      â†’ Script principal d'anonymisation
2. install.sh                 â†’ Installation automatique des dÃ©pendances

3. anonymize_rules.json       â†’ RÃ¨gles d'anonymisation (modifiable)
4. config_local.conf          â†’ Exemple configuration locale
5. config_remote.conf         â†’ Exemple configuration distante

6. README.md                  â†’ Documentation complÃ¨te
7. PACKAGE_INFO.txt           â†’ Informations dÃ©taillÃ©es
8. QUICK_START.sh             â†’ Guide de dÃ©marrage interactif
9. test_package.sh            â†’ Script de test
10. INSTALL.txt               â†’ Ce fichier


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ðŸš€ INSTALLATION COMPLÃˆTE (3 COMMANDES)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# 1. Rendre les scripts exÃ©cutables
chmod +x *.sh

# 2. Installer les dÃ©pendances
./install.sh

# 3. Tester l'installation
./test_package.sh


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âš™ï¸ CONFIGURATION (2 MINUTES)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# 1. Copier un exemple de configuration
cp config_local.conf ma_config.conf

# 2. Ã‰diter selon vos besoins (voir exemples dans le fichier)
vim ma_config.conf

# ParamÃ¨tres essentiels Ã  modifier :
#   - SOURCE_HOST, SOURCE_DB, SOURCE_SCHEMA, SOURCE_USER
#   - TARGET_HOST, TARGET_DB, TARGET_SCHEMA, TARGET_USER
#   - SOURCE_SERVER et TARGET_SERVER (si serveurs diffÃ©rents)

# 3. VÃ©rifier/adapter les rÃ¨gles d'anonymisation
vim anonymize_rules.json

# 4. (Optionnel mais recommandÃ©) Configurer .pgpass pour la sÃ©curitÃ©
cat > ~/.pgpass << 'EOF'
localhost:5432:ma_base_source:postgres:mon_password_source
localhost:5432:ma_base_target:postgres:mon_password_target
EOF
chmod 600 ~/.pgpass


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â–¶ï¸  EXÃ‰CUTION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# ExÃ©cution simple
./pg_anonymize_dump.sh ma_config.conf

# Avec nohup pour laisser tourner en arriÃ¨re-plan
nohup ./pg_anonymize_dump.sh ma_config.conf > execution.log 2>&1 &

# Suivre les logs en temps rÃ©el
tail -f anonymize_*.log


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ðŸ“š AIDE ET DOCUMENTATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Afficher l'aide
./pg_anonymize_dump.sh --help

# Afficher un exemple de configuration
./pg_anonymize_dump.sh --example-config

# Afficher un exemple de rÃ¨gles
./pg_anonymize_dump.sh --example-rules

# Consulter le guide de dÃ©marrage rapide
./QUICK_START.sh

# Lire la documentation complÃ¨te
cat README.md

# Afficher les infos du package
cat PACKAGE_INFO.txt


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ðŸŽ¯ EXEMPLE COMPLET D'UTILISATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# SCÃ‰NARIO : Anonymiser production vers staging (mÃªme serveur)

# 1. Installation
chmod +x *.sh
./install.sh

# 2. Configuration
cat > ma_config.conf << 'EOF'
SOURCE_HOST="localhost"
SOURCE_PORT="5432"
SOURCE_DB="production_db"
SOURCE_SCHEMA="public"
SOURCE_USER="postgres"
SOURCE_PASSWORD=""

TARGET_HOST="localhost"
TARGET_PORT="5432"
TARGET_DB="staging_db"
TARGET_SCHEMA="public"
TARGET_USER="postgres"
TARGET_PASSWORD=""

SOURCE_SERVER=""
TARGET_SERVER=""

DUMP_DIR="/tmp/pg_dumps"
TRANSFER_METHOD="local"
ANONYMIZE_RULES_FILE="anonymize_rules.json"

AUTO_DETECT_PII=true
KEEP_DUMP_AFTER_RESTORE=false
BACKUP_TARGET_BEFORE=true
PARALLEL_JOBS=4

DUMP_FORMAT="custom"
COMPRESSION_LEVEL=6
EOF

# 3. Configurer .pgpass
cat > ~/.pgpass << 'EOF'
localhost:5432:production_db:postgres:mon_mot_de_passe
localhost:5432:staging_db:postgres:mon_mot_de_passe
EOF
chmod 600 ~/.pgpass

# 4. ExÃ©cuter
./pg_anonymize_dump.sh ma_config.conf

# 5. VÃ©rifier les rÃ©sultats
psql -h localhost -U postgres -d staging_db -c "SELECT email, nom FROM users LIMIT 5;"
# Devrait afficher des emails du type : user_abc123@anonymized.local


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ðŸ”§ CONFIGURATION POUR DEUX SERVEURS DIFFÃ‰RENTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# SCÃ‰NARIO : Source sur serveur1, Target sur serveur2

# 1. Configurer SSH (sur votre PC ou serveur1)
ssh-keygen -t rsa  # Si pas dÃ©jÃ  fait
ssh-copy-id user@serveur1
ssh-copy-id user@serveur2

# 2. Configuration
cat > ma_config.conf << 'EOF'
SOURCE_HOST="192.168.1.10"
SOURCE_PORT="5432"
SOURCE_DB="production_db"
SOURCE_SCHEMA="public"
SOURCE_USER="postgres"
SOURCE_PASSWORD=""

TARGET_HOST="192.168.1.20"
TARGET_PORT="5432"
TARGET_DB="staging_db"
TARGET_SCHEMA="public"
TARGET_USER="postgres"
TARGET_PASSWORD=""

SOURCE_SERVER="user@192.168.1.10"
TARGET_SERVER="user@192.168.1.20"

DUMP_DIR="/tmp/pg_dumps"
TRANSFER_METHOD="rsync"
ANONYMIZE_RULES_FILE="anonymize_rules.json"

AUTO_DETECT_PII=true
KEEP_DUMP_AFTER_RESTORE=false
BACKUP_TARGET_BEFORE=true
PARALLEL_JOBS=4

DUMP_FORMAT="custom"
COMPRESSION_LEVEL=6
EOF

# 3. Configurer .pgpass sur chaque serveur
ssh user@serveur1 "cat > ~/.pgpass << 'EOF'
192.168.1.10:5432:production_db:postgres:password_source
EOF
chmod 600 ~/.pgpass"

ssh user@serveur2 "cat > ~/.pgpass << 'EOF'
192.168.1.20:5432:staging_db:postgres:password_target
EOF
chmod 600 ~/.pgpass"

# 4. ExÃ©cuter
./pg_anonymize_dump.sh ma_config.conf


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âš¡ OPTIMISATION POUR GRANDES BASES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Pour bases > 100 GB
cat > config_grande_base.conf << 'EOF'
# ... autres paramÃ¨tres identiques ...

# Optimisations
DUMP_FORMAT="directory"        # Meilleur pour gros volumes
PARALLEL_JOBS=16               # Augmenter selon CPU disponible
COMPRESSION_LEVEL=1            # Moins de compression = plus rapide
TRANSFER_METHOD="rsync"        # Plus efficace que scp

# Conserver le dump pour analyse ultÃ©rieure
KEEP_DUMP_AFTER_RESTORE=true
EOF


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ðŸ› RÃ‰SOLUTION DES PROBLÃˆMES COURANTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PROBLÃˆME : "command not found: pg_dump"
SOLUTION : ./install.sh n'a pas Ã©tÃ© exÃ©cutÃ© ou a Ã©chouÃ©
           â†’ Relancer ./install.sh

PROBLÃˆME : "Permission denied" lors du transfert SSH
SOLUTION : Configurer les clÃ©s SSH
           â†’ ssh-copy-id user@serveur

PROBLÃˆME : "Database already exists: temp_anon_xxxxx"
SOLUTION : Une exÃ©cution prÃ©cÃ©dente a Ã©chouÃ©
           â†’ psql -U postgres -c "DROP DATABASE temp_anon_xxxxx;"

PROBLÃˆME : "No space left on device"
SOLUTION : Pas assez d'espace disque
           â†’ LibÃ©rer de l'espace ou changer DUMP_DIR

PROBLÃˆME : ExÃ©cution trÃ¨s lente
SOLUTION : Augmenter PARALLEL_JOBS, rÃ©duire COMPRESSION_LEVEL
           â†’ PARALLEL_JOBS=8, COMPRESSION_LEVEL=3

PROBLÃˆME : "FATAL: password authentication failed"
SOLUTION : ProblÃ¨me de mot de passe
           â†’ VÃ©rifier .pgpass ou les variables PASSWORD dans config


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ðŸ“Š VÃ‰RIFICATION POST-EXÃ‰CUTION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# 1. VÃ©rifier les logs
cat anonymize_*.log

# 2. Consulter le rapport
cat /tmp/pg_dumps/report_*.txt

# 3. Tester quelques requÃªtes
psql -h TARGET_HOST -U TARGET_USER -d TARGET_DB << EOF
-- VÃ©rifier que les emails sont anonymisÃ©s
SELECT email FROM users LIMIT 5;

-- VÃ©rifier que les tÃ©lÃ©phones sont anonymisÃ©s
SELECT phone FROM users LIMIT 5;

-- Compter le nombre de lignes (devrait Ãªtre identique Ã  la source)
SELECT COUNT(*) FROM users;
EOF

# 4. VÃ©rifier visuellement quelques lignes
psql -h TARGET_HOST -U TARGET_USER -d TARGET_DB -c "
SELECT * FROM users LIMIT 3;
"


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ… CHECKLIST FINALE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â˜ DÃ©pendances installÃ©es (./install.sh)
â˜ Configuration crÃ©Ã©e et validÃ©e
â˜ .pgpass configurÃ© (recommandÃ©)
â˜ SSH configurÃ© si nÃ©cessaire
â˜ Espace disque vÃ©rifiÃ© (au moins 2x la taille de la base source)
â˜ Test sur petite base effectuÃ©
â˜ Backup de sÃ©curitÃ© crÃ©Ã©
â˜ Anonymisation vÃ©rifiÃ©e manuellement
â˜ Logs archivÃ©s


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ðŸ“ž BESOIN D'AIDE ?
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Consulter README.md pour la documentation complÃ¨te
2. Lancer ./QUICK_START.sh pour le guide interactif
3. Utiliser ./test_package.sh pour diagnostiquer les problÃ¨mes
4. VÃ©rifier les logs : anonymize_*.log


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PrÃªt Ã  commencer ? Lancez :

    chmod +x *.sh && ./install.sh

Puis consultez le guide de dÃ©marrage :

    ./QUICK_START.sh

Bonne anonymisation ! ðŸŽ­

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
